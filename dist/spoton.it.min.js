angular.module("spoton.it.ui",[]),angular.module("spoton.it.services",["spoton.it.rest.service","spoton.it.cache.service","spoton.it.event-bus.service"]),angular.module("spoton.it",["spoton.it.ui","spoton.it.services","ui.router","ui.bootstrap","ngAnimate","toaster"]).config(function($httpProvider,$stateProvider,$urlRouterProvider){$httpProvider.defaults.transformRequest=function(data){return void 0===data?data:$.param(data)},$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"],$httpProvider.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",$httpProvider.defaults.headers["delete"]={"Content-Type":"application/json; charset=UTF-8"},$urlRouterProvider.otherwise("/list"),$stateProvider.state("list",{url:"/list",views:{"header@":{templateUrl:"src/common/layout/header.html",controller:"HeaderController as hc"},"main-content@":{templateUrl:"src/events/list.html",controller:"EventsListController as lc"}}}).state("grid",{url:"/grid",views:{"header@":{templateUrl:"src/common/layout/header.html",controller:"HeaderController as hc"},"main-content@":{templateUrl:"src/events/grid.html",controller:"EventsGridController as gc"}}})}),function(){"use strict";var ramFixContainer=function(){var link=function(scope,element){function resizeContainers(containerId){var heights=$(containerId).map(function(){return $(this).height()}).get(),maxHeight=2*Math.max.apply(null,heights);$(containerId).height(maxHeight)}resizeContainers(element)};return{restrict:"EA",link:link}};angular.module("spoton.it").directive("ramFixContainer",[ramFixContainer])}(),function(){"use strict";angular.module("spoton.it").constant("Constants",{URLS:{STANFORD:"http://events.stanford.edu/",EVENT_BRITE:"https://www.eventbrite.com/",SFMOMA:"http://www.sfmoma.org/",MEETUP:"http://www.meetup.com/find/events/?allMeetups=true&radius=5&userFreeform=Redwood+City%2C+CA&mcId=z94061&mcName=Redwood+City%2C+CA"},MOCK_URLS:{STANFORD:"src/common/data/stanford.html",EVENT_BRITE:"src/common/data/eventbrite.html",SFMOMA:"src/common/data/sfmoma.html",MEETUP:"src/common/data/meetup.html"},EVENTS:{EVENT_SOURCE_CHANGED:"eventSourceChanged"},CACHE:{SELECTED_EVENTS:"selectedEvents"}})}(),function(){"use strict";var HeaderController=function($state,Constants,EventsService,EventBusService){function init(){$state.is("grid")&&(hc.listActive=!1)}function _showGrid(){$state.go("grid"),hc.listActive=!1}function _showList(){$state.go("list"),hc.listActive=!0}function _loadEvents(site){switch(hc.dropdownTitle=site,site){case"Eventbrite":EventBusService.pub(Constants.EVENTS.EVENT_SOURCE_CHANGED,Constants.MOCK_URLS.EVENT_BRITE);break;case"Stanford Events":EventBusService.pub(Constants.EVENTS.EVENT_SOURCE_CHANGED,Constants.MOCK_URLS.STANFORD);break;case"Meetup":EventBusService.pub(Constants.EVENTS.EVENT_SOURCE_CHANGED,Constants.MOCK_URLS.MEETUP);break;case"SF MOMA":EventBusService.pub(Constants.EVENTS.EVENT_SOURCE_CHANGED,Constants.MOCK_URLS.SFMOMA)}}var hc=this;hc.dropdownTitle="Find Events In Your Area!",hc.init=init,hc.showGrid=_showGrid,hc.showList=_showList,hc.loadEvents=_loadEvents,hc.listActive=!0,init()};angular.module("spoton.it").controller("HeaderController",["$state","Constants","EventsService","EventBusService",HeaderController])}(),function(){"use strict";var CacheService=function(){var _setItem=function(key,val){sessionStorage.setItem(key,JSON.stringify(val))},_getItem=function(item){return angular.fromJson?angular.fromJson(sessionStorage.getItem(item)):void 0},_removeItem=function(item){sessionStorage.removeItem(item)},_clearCache=function(){sessionStorage.clear()};return{setItem:_setItem,getItem:_getItem,removeItem:_removeItem,clearCache:_clearCache}};angular.module("spoton.it.cache.service",[]).factory("CacheService",[CacheService])}(),function(){"use strict";var EventBusService=function($rootScope){var _destroyScope=function(scope,unsubscribe){$rootScope.$on("$destroy",unsubscribe)},_pub=function(name,message){$rootScope.$emit(name,message)},_sub=function(scope,name,handler){var unsubscribe=$rootScope.$on(name,function(event,message){handler(message)});_destroyScope(scope,unsubscribe)};return{pub:_pub,sub:_sub}};angular.module("spoton.it.event-bus.service",[]).factory("EventBusService",["$rootScope",EventBusService])}(),function(){"use strict";var RestService=function($http,$q,$rootScope){var _buildUrl=function(url,argList){var finalURL=url;if(argList||argList==[])for(var replaceStr="",i=0;i<argList.length;i++)replaceStr="{"+i+"}",finalURL=finalURL.replace(replaceStr,argList[i]);return finalURL},_executeHttpRequest=function(method,url,urlReplaceList,params,successFunction,errorMsg,errorFunction,config){config&&config.hasOwnProperty("showLoader")&&($rootScope.showLoader=config.showLoader),urlReplaceList&&(url=_buildUrl(url,urlReplaceList)),$http({method:method,url:url,params:params,cache:!1}).success(function(data,status,headers,config){$rootScope.showLoader=!1,void 0===successFunction?_defaultSuccessFunction(data,status,headers,config):successFunction(data,status,headers,config)}).error(function(data,status,headers,config){$rootScope.showLoader=!1,0!==status&&_processError(data,status,headers,config,errorMsg,errorFunction)})},_defaultSuccessFunction=function(data){console.log("Successfully received data, no functionality defined to proccess it. ",data)},_processError=function(data,status,headers,config,errorMsg,errorFunction){errorMsg&&AlertService.addErrorMessage(errorMsg,!0),errorFunction&&errorFunction(data,status,headers,config)},_getData=function(url,urlReplaceList,params,successFunction,errorMsg,errorFunction,config){_executeHttpRequest("GET",url,urlReplaceList,params,successFunction,errorMsg,errorFunction,config)},_putData=function(url,urlReplaceList,params,successFunction,errorMsg,errorFunction,config){_executeHttpRequest("PUT",url,urlReplaceList,params,successFunction,errorMsg,errorFunction,config)},_deleteData=function(url,urlReplaceList,params,successFunction,errorMsg,errorFunction,config){_executeHttpRequest("DELETE",url,urlReplaceList,params,successFunction,errorMsg,errorFunction,config)},_putPostData=function(url,urlReplaceList,params,data,successFunction,errorMsg,errorFunction,config){config&&config.hasOwnProperty("showLoader")&&($rootScope.showLoader=config.showLoader),urlReplaceList&&(url=_buildUrl(url,urlReplaceList)),$http({method:"PUT",url:url,params:params,data:data,cache:!1}).success(function(postData,status,headers,config){$rootScope.showLoader=!1,void 0===successFunction?_defaultSuccessFunction(postData,status,headers,config):successFunction(data,status,headers,config)}).error(function(postData,status,headers,config){$rootScope.showLoader=!1,0!==status&&_processError(postData,status,headers,config,errorMsg,errorFunction)})},_postData=function(url,urlReplaceList,params,data,successFunction,errorMsg,errorFunction,config){config&&config.hasOwnProperty("showLoader")&&($rootScope.showLoader=config.showLoader),urlReplaceList&&(url=_buildUrl(url,urlReplaceList)),$http({method:"POST",url:url,params:params,data:data,cache:!1}).success(function(postData,status,headers,config){$rootScope.showLoader=!1,void 0===successFunction?_defaultSuccessFunction(postData,status,headers,config):successFunction(postData,status,headers,config)}).error(function(postData,status,headers,config){$rootScope.showLoader=!1,0!==status&&_processError(postData,status,headers,config,errorMsg,errorFunction)})};return{getData:_getData,postData:_postData,putData:_putData,deleteData:_deleteData,putPostData:_putPostData}};angular.module("spoton.it.rest.service",[]).factory("RestService",["$http","$q","$rootScope",RestService])}(),function(){"use strict";var EventsGridController=function(EventsService,Constants,EventBusService,CacheService){function init(){var events=CacheService.getItem(Constants.CACHE.SELECTED_EVENTS);events?(gc.events=[],gc.events=events):gc.getEvents(Constants.MOCK_URLS.STANFORD)}function getEvents(url){var events=CacheService.getItem(Constants.CACHE.SELECTED_EVENTS);return events?events:(EventsService.getEvents(url).then(function(data){gc.events=[],gc.events=data,CacheService.setItem(Constants.CACHE.SELECTED_EVENTS,data)}),void 0)}var gc=this;gc.events=[],gc.pageTitle="",gc.init=init,gc.getEvents=getEvents,init(),EventBusService.sub(gc,Constants.EVENTS.EVENT_SOURCE_CHANGED,function(message){CacheService.removeItem(Constants.CACHE.SELECTED_EVENTS),gc.getEvents(message)})};angular.module("spoton.it").controller("EventsGridController",["EventsService","Constants","EventBusService","CacheService",EventsGridController])}(),function(){"use strict";var EventsListController=function(EventsService,Constants,EventBusService,CacheService){function init(){var events=CacheService.getItem(Constants.CACHE.SELECTED_EVENTS);events?(lc.events=[],lc.events=events):lc.getEvents(Constants.MOCK_URLS.STANFORD)}function getEvents(url){var events=CacheService.getItem(Constants.CACHE.SELECTED_EVENTS);return events?events:(EventsService.getEvents(url).then(function(data){lc.events=[],lc.events=data,CacheService.setItem(Constants.CACHE.SELECTED_EVENTS,data)}),void 0)}var lc=this;lc.events=[],lc.init=init,lc.getEvents=getEvents,init(),EventBusService.sub(lc,Constants.EVENTS.EVENT_SOURCE_CHANGED,function(message){CacheService.removeItem(Constants.CACHE.SELECTED_EVENTS),lc.getEvents(message)})};angular.module("spoton.it").controller("EventsListController",["EventsService","Constants","EventBusService","CacheService",EventsListController])}(),function(){"use strict";var EventsService=function(RestService,$q,$http,Constants){var _getEvents=function(url){var deferred=$q.defer();return $http.get(url).success(function(data){deferred.resolve(_buildEventsJSON(url,data))}).error(function(data){deferred.resolve(data),console.log("oh no!!")}),deferred.promise},_buildEventsJSON=function(url,data){switch(url){case Constants.MOCK_URLS.STANFORD:return _buildStanfordEvents(data);case Constants.MOCK_URLS.EVENT_BRITE:return _buildEventbriteEvents(data);case Constants.MOCK_URLS.MEETUP:return _buildMeetupEvents(data);case Constants.MOCK_URLS.SFMOMA:return _buildSfMomaEvents(data)}},_buildStanfordEvents=function(data){var elements=$("<div>").html(data)[0].getElementsByClassName("postcard-link"),events=[];return $(elements).each(function(){var link=$(this).attr("href"),body=$(this).children("div"),poster=$(body).eq(0).children("div[class='postcard-image']").children().eq(0).attr("src"),title=$(body).eq(0).children("div[class='postcard-text']").children("H3").text().replace(/\r?\n|\r/g," ").replace(/\s+/g," "),time=$(body).eq(0).children("div[class='postcard-text']").children().eq(1).children().eq(0).first().text().split(" "),dt="",location=$(body).eq(0).children("div[class='postcard-text']").children().eq(1).text().split("\n")[1].replace(/\r?\n|\r/g," ").replace(/\s+/g," ");time.forEach(function(element){dt+=element.replace(/\r?\n|\r/g," ").replace(/\s+/g," ")+" "});var event={link:Constants.URLS.STANFORD+link,poster:Constants.URLS.STANFORD+poster,title:title,time:dt,location:location};events.push(event)}),events},_buildEventbriteEvents=function(data){var elements=$("<div>").html(data)[0].getElementsByClassName("event-poster"),events=[];return $(elements).each(function(){var time=$(this).children().eq(1).children().eq(0).children(),poster=$(this).children().eq(1).children().eq(1).children().attr("src"),title=$(this).children().eq(2).children().children().first().text().trim(),link=$(this).children().eq(2).children().attr("href"),location=$(this).children().eq(2).children().children().next().text().trim(),dt="";dt+=time.eq(0).text(),dt+=" "+time.eq(1).text();var event={link:link,poster:poster,title:title,time:dt,location:location};events.push(event)}),events},_buildMeetupEvents=function(data){var elements=$("<div>").html(data)[0].getElementsByClassName("event-listing-container-li"),events=[];return $(elements).each(function(){var time=$(this).children(0).find('time[itemprop="startDate"]').first().text(),poster=$(this).children().eq(1).children().eq(1).children().attr("src")||"src/common/assets/images/Meetup.png",title=$(this).children(0).find('div[itemprop="location"]').siblings().first().find('span[itemprop="summary"]').text(),link=$(this).children(0).find('div[itemprop="location"]').first().find("a").attr("href"),location=$(this).children(0).find('div[itemprop="location"]').first().find('span[itemprop="name"]').text(),dt=$(this).children(0).find('time[itemprop="startDate"]').first().attr("datetime"),event={link:link,poster:poster,title:title,time:dt+" "+time,location:location};events.push(event)}),events},_buildSfMomaEvents=function(data){var elements=$("<div>").html(data)[0].getElementsByClassName("mod-link");elements=$(elements).has('h4[class="benton"]');var events=[];return $(elements).each(function(){var time=$(this).find('div[class="bd"] div[class="date"]').text(),poster=Constants.URLS.SFMOMA+$(this).find('div[class="image-mat left"]').children().attr("src"),title=$(this).find('div[class="bd"] div[class="title benton"]').text(),link=$(this).children(0).find('div[itemprop="location"]').first().find("a").attr("href"),location=$(this).children("H4").text(),event={link:link,poster:poster,title:title,time:time,location:location};events.push(event)}),events};return{getEvents:_getEvents}};angular.module("spoton.it").factory("EventsService",["RestService","$q","$http","Constants",EventsService])}();